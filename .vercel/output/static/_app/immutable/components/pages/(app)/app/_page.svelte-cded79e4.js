import{S as $e,i as ve,s as be,T as we,U as ke,k as w,w as J,a as S,q as O,l as k,m as y,x as K,c as T,h,r as W,n as f,b as H,G as u,y as Q,P as Ee,V as Ie,f as Y,t as Z,z as ee,W as de,H as ye,o as Pe,X as te}from"../../../../chunks/index-eaa75a16.js";import{p as Ve}from"../../../../chunks/stores-e5294287.js";import{B as re}from"../../../../chunks/Button-d077c606.js";import{I as De}from"../../../../chunks/Input-9a1c64f8.js";import{h as ie,s as M}from"../../../../chunks/db-8e0000c5.js";function he(n,e,t){const s=n.slice();return s[11]=e[t],s}function me(n,e,t){const s=n.slice();return s[11]=e[t],s[15]=t,s}function Ge(n){let e;return{c(){e=O("Invia")},l(t){e=W(t,"Invia")},m(t,s){H(t,e,s)},d(t){t&&h(e)}}}function Se(n){let e;return{c(){e=O("Addestra")},l(t){e=W(t,"Addestra")},m(t,s){H(t,e,s)},d(t){t&&h(e)}}}function Te(n){let e;return{c(){e=O("Genera")},l(t){e=W(t,"Genera")},m(t,s){H(t,e,s)},d(t){t&&h(e)}}}function ge(n){let e,t,s,r,i;return{c(){e=w("div"),t=w("img"),i=S(),this.h()},l(p){e=k(p,"DIV",{class:!0});var o=y(e);t=k(o,"IMG",{src:!0,loading:!0,alt:!0,class:!0}),i=T(o),o.forEach(h),this.h()},h(){te(t.src,s=n[11].url)||f(t,"src",s),f(t,"loading","eager"),f(t,"alt",r=n[11].name),f(t,"class","rounded-box aspect-square h-[30vh]"),f(e,"class","carousel-item")},m(p,o){H(p,e,o),u(e,t),u(e,i)},p(p,o){o&2&&!te(t.src,s=p[11].url)&&f(t,"src",s),o&2&&r!==(r=p[11].name)&&f(t,"alt",r)},d(p){p&&h(e)}}}function pe(n){let e,t,s;return{c(){e=w("img"),this.h()},l(r){e=k(r,"IMG",{src:!0,alt:!0}),this.h()},h(){te(e.src,t=n[11].url)||f(e,"src",t),f(e,"alt",s=n[11].name)},m(r,i){H(r,e,i)},p(r,i){i&4&&!te(e.src,t=r[11].url)&&f(e,"src",t),i&4&&s!==(s=r[11].name)&&f(e,"alt",s)},d(r){r&&h(e)}}}function qe(n){let e,t,s,r,i,p,o,R,$,q,E,X,P,d,_,D,v,z,ae,V,U,L,se,ne,j,le,oe;function _e(a){n[6](a)}let ce={type:"file",label:"Photos",id:"photos",multiple:!0};n[0]!==void 0&&(ce.input=n[0]),r=new De({props:ce}),we.push(()=>ke(r,"input",_e,n[0])),o=new re({props:{size:"small",type:"submit",$$slots:{default:[Ge]},$$scope:{ctx:n}}}),$=new re({props:{size:"small",type:"button",disabled:!0,$$slots:{default:[Se]},$$scope:{ctx:n}}}),$.$on("click",n[7]),E=new re({props:{size:"small",type:"button",disabled:!0,$$slots:{default:[Te]},$$scope:{ctx:n}}}),E.$on("click",n[8]);let B=n[1],m=[];for(let a=0;a<B.length;a+=1)m[a]=ge(me(n,B,a));let F=n[2],g=[];for(let a=0;a<F.length;a+=1)g[a]=pe(he(n,F,a));return{c(){e=w("div"),t=w("div"),s=w("form"),J(r.$$.fragment),p=S(),J(o.$$.fragment),R=S(),J($.$$.fragment),q=S(),J(E.$$.fragment),X=S(),P=w("div"),d=w("article"),_=w("h1"),D=O("Photos for training"),v=S(),z=w("div");for(let a=0;a<m.length;a+=1)m[a].c();ae=S(),V=w("div"),U=w("article"),L=w("h1"),se=O("Photos generated"),ne=S();for(let a=0;a<g.length;a+=1)g[a].c();this.h()},l(a){e=k(a,"DIV",{class:!0});var c=y(e);t=k(c,"DIV",{class:!0});var b=y(t);s=k(b,"FORM",{class:!0});var I=y(s);K(r.$$.fragment,I),p=T(I),K(o.$$.fragment,I),R=T(I),K($.$$.fragment,I),q=T(I),K(E.$$.fragment,I),I.forEach(h),b.forEach(h),X=T(c),P=k(c,"DIV",{class:!0});var A=y(P);d=k(A,"ARTICLE",{class:!0});var N=y(d);_=k(N,"H1",{});var l=y(_);D=W(l,"Photos for training"),l.forEach(h),N.forEach(h),v=T(A),z=k(A,"DIV",{class:!0});var G=y(z);for(let C=0;C<m.length;C+=1)m[C].l(G);G.forEach(h),A.forEach(h),ae=T(c),V=k(c,"DIV",{class:!0});var x=y(V);U=k(x,"ARTICLE",{class:!0});var ue=y(U);L=k(ue,"H1",{});var fe=y(L);se=W(fe,"Photos generated"),fe.forEach(h),ue.forEach(h),ne=T(x);for(let C=0;C<g.length;C+=1)g[C].l(x);x.forEach(h),c.forEach(h),this.h()},h(){f(s,"class","px-5 py-7 flex flex-col items-center gap-4"),f(t,"class","w-full bg-white shadow rounded-lg divide-y divide-gray-200"),f(d,"class","prose"),f(z,"class","carousel carousel-center p-4 space-x-4 bg-neutral"),f(P,"class","w-full bg-white shadow rounded-lg divide-y divide-gray-200 p-6"),f(U,"class","prose"),f(V,"class","w-full bg-white shadow rounded-lg divide-y divide-gray-200 p-6"),f(e,"class","w-full max-w-sm mx-auto my-16 px-2 flex flex-col gap-4")},m(a,c){H(a,e,c),u(e,t),u(t,s),Q(r,s,null),u(s,p),Q(o,s,null),u(s,R),Q($,s,null),u(s,q),Q(E,s,null),u(e,X),u(e,P),u(P,d),u(d,_),u(_,D),u(P,v),u(P,z);for(let b=0;b<m.length;b+=1)m[b].m(z,null);u(e,ae),u(e,V),u(V,U),u(U,L),u(L,se),u(V,ne);for(let b=0;b<g.length;b+=1)g[b].m(V,null);j=!0,le||(oe=Ee(s,"submit",n[3]),le=!0)},p(a,[c]){const b={};!i&&c&1&&(i=!0,b.input=a[0],Ie(()=>i=!1)),r.$set(b);const I={};c&65536&&(I.$$scope={dirty:c,ctx:a}),o.$set(I);const A={};c&65536&&(A.$$scope={dirty:c,ctx:a}),$.$set(A);const N={};if(c&65536&&(N.$$scope={dirty:c,ctx:a}),E.$set(N),c&2){B=a[1];let l;for(l=0;l<B.length;l+=1){const G=me(a,B,l);m[l]?m[l].p(G,c):(m[l]=ge(G),m[l].c(),m[l].m(z,null))}for(;l<m.length;l+=1)m[l].d(1);m.length=B.length}if(c&4){F=a[2];let l;for(l=0;l<F.length;l+=1){const G=he(a,F,l);g[l]?g[l].p(G,c):(g[l]=pe(G),g[l].c(),g[l].m(V,null))}for(;l<g.length;l+=1)g[l].d(1);g.length=F.length}},i(a){j||(Y(r.$$.fragment,a),Y(o.$$.fragment,a),Y($.$$.fragment,a),Y(E.$$.fragment,a),j=!0)},o(a){Z(r.$$.fragment,a),Z(o.$$.fragment,a),Z($.$$.fragment,a),Z(E.$$.fragment,a),j=!1},d(a){a&&h(e),ee(r),ee(o),ee($),ee(E),de(m,a),de(g,a),le=!1,oe()}}}function ze(n,e,t){let s;ye(n,Ve,d=>t(9,s=d));async function r(){var d;if(i.files)for(let _=0;_<i.files.length;_++)await M.storage.from("photos-for-training").upload(((d=s.data.session)==null?void 0:d.user.id)+"/"+i.files[_].name,await i.files[_].arrayBuffer())}let i;async function p(){await M.functions.invoke("train")}async function o(){await M.functions.invoke("generate")}let R=[],$=[];async function q(d,_){var D;return ie(await M.storage.from(d).createSignedUrl(((D=s.data.session)==null?void 0:D.user.id)+"/"+_,60)).signedUrl}Pe(async()=>{var d,_;{t(1,R=await Promise.all(ie(await M.storage.from("photos-for-training").list((d=s.data.session)==null?void 0:d.user.id)).map(async v=>({url:await q("photos-for-training",v.name),name:v.name})))),t(2,$=await Promise.all(ie(await M.storage.from("photos-generated").list((_=s.data.session)==null?void 0:_.user.id)).map(async v=>({url:await q("photos-generated",v.name),name:v.name}))));const D=M.channel("public:photos").on("postgres_changes",{event:"INSERT",schema:"public",table:"photos"},async v=>{"uid"in v.new&&t(2,$=[...$,{url:await q("photos-generated",v.new.name),name:v.new.name}])}).subscribe();return()=>{D.unsubscribe()}}});function E(d){i=d,t(0,i)}return[i,R,$,r,p,o,E,()=>p(),()=>o()]}class Be extends $e{constructor(e){super(),ve(this,e,ze,qe,be,{})}}export{Be as default};
